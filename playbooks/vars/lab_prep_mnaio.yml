#####################################
# libvirt provisioning network config
#####################################
provisioning_name: "provisioning"
provisioning_netmask: "255.255.252.0"
provisioning_network_cidr: "172.0.60.0/22"
provisioning_gateway_ip: "172.0.60.1"       
provisioning_range_start: "172.0.60.101"
provisioning_range_end: "172.0.63.254"

#############################################
# General openstack network configs
# separate from mnaio libvirt settings.
# differs based on the lab environment. 
#############################################
external_controller_ips:
  - 172.0.60.20
  - 172.0.60.21
  - 172.0.60.22
external_network_cidr: "{{ provisioning_network_cidr }}"
external_network_gateway: "{{ provisioning_gateway_ip }}"
external_floating_ip: 172.0.60.100


# Each environment's network is different. (used to decide which custom-nic templates to use for rpcr)
lab_network_environment: "mnaio"

# Each environment may have a different disk layout and config. 
# We are using this to decide which template to render.
lab_ceph_config: "mnaio_storage_layout"


##########################################
# Org and Location that holds the labs
# The labs are defined with domains
##########################################
lab_org_name: "Lab Organization"
lab_location_name: "Lab Location"


#######################
# Base domain name
#######################
lab_base_domain_name: "mnaio.rpc.rackspace.com"

##################
# Base image path
##################
base_image_path: "/var/lib/libvirt/images"


###############################################################
# Set up some global parameters to be used for domain creation
###############################################################

additional_foreman_global_parameters:
  - key: "lab_org_name"
    value: '{{ lab_org_name }}'
  - key: "lab_location_name"
    value: '{{ lab_location_name }}'
  - key: "lab_base_domain_name"
    value: '{{ lab_base_domain_name }}'
  - key: "multicast_group_base"
    value: "239.1.33"
  - key: "vxlan_network_prefix"
    value: "172.22"
  - key: "vxlan_netmask"
    value: "255.255.252.0"
  - key: "vxlan_third_octet_step"
    value: 4
  - key: "vxlan_networks"
    value: "mgmt,stor-mgmt,storage,tenant,lbaas,inside-net,gw-net"

################
# List of users
################
foreman_users:
  - username: labadmin
    password: change4me
    mail: shannon.mitchell@rackspace.com
    admin: yes
    default_organization: '{{ lab_org_name }}'
    default_location: '{{ lab_location_name }}'
    description: "Lab Admin"
    firstname: Lab
    lastname: Admin


#######################################
# Openstack project used for instances
#######################################

openstack_domain_name: "default"
openstack_domain_desc: "Shared LAB Project"
openstack_project_name: "labs-project"
openstack_project_desc: "Shared Lab Project"
openstack_project_admin_user: "labs-admin"
openstack_project_admin_pass: "change4me"
openstack_project_admin_desc: "LABS Domain Admin User"
openstack_project_admin_email: "shannon.mitchell@rackspace.com"

    
########################################################
# For vlans on ironic nodes, we will have to have a way
# to pre-define and check-in/check-out the static labs.
# The static labs, are just a collection of VLANS and 
# networks set up by netsec that is shared across all 
# ironic nodes in the phobos cluster.
########################################################
static_labs:
  - domain_name: "lab1.{{ lab_base_domain_name }}"
    domain_organizations: 
      - '{{ lab_org_name }}'
    domain_locations:
      - '{{ lab_location_name }}'
    domain_description: "LAB1 Static Domain"
    domain_parameters:
      - name: "type"
        value: "vlan"
        parameter_type: "string"
      - name: "in-use"
        value: "no"
        parameter_type: "string"
      - name: "internal_floating_ip"
        value: "172.0.64.10"
        parameter_type: "string"
      - name: "internal_vrid"
        value: "12"
        parameter_type: "string"
      - name: "external_vrid"
        value: "13"
        parameter_type: "string"
    domain_subnets:
      - subnet_name: "LAB1-MGMT"
        subnet_description: "LAB1 management network with static VLANs"
        subnet_vlan: 201
        subnet_type: "IPv4"
        subnet_network: "172.0.64.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.64.50"
        subnet_dhcp_to: "172.0.64.254"
        subnet_gateway: "172.0.64.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-STOR-MGMT"
        subnet_description: "LAB1 storage management network with static VLANs"
        subnet_vlan: 202
        subnet_type: "IPv4"
        subnet_network: "172.0.68.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.68.50"
        subnet_dhcp_to: "172.0.68.254"
        subnet_gateway: "172.0.68.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-STORAGE"
        subnet_description: "LAB1 storage network with static VLANs"
        subnet_vlan: 203
        subnet_type: "IPv4"
        subnet_network: "172.0.72.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.72.50"
        subnet_dhcp_to: "172.0.72.254"
        subnet_gateway: "172.0.72.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-TENANT"
        subnet_description: "LAB1 tenant network with static VLANs"
        subnet_vlan: 204
        subnet_type: "IPv4"
        subnet_network: "172.0.76.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.76.50"
        subnet_dhcp_to: "172.0.76.254"
        subnet_gateway: "172.0.76.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-LBAAS"
        subnet_description: "LAB1 lbaas network with static VLANs"
        subnet_vlan: 205
        subnet_type: "IPv4"
        subnet_network: "172.0.80.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.80.50"
        subnet_dhcp_to: "172.0.80.254"
        subnet_gateway: "172.0.80.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-INSIDE-NET"
        subnet_description: "LAB1 inside net network with static VLANs"
        subnet_vlan: 206
        subnet_type: "IPv4"
        subnet_network: "172.0.84.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.84.50"
        subnet_dhcp_to: "172.0.84.254"
        subnet_gateway: "172.0.84.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-GW-NET"
        subnet_description: "LAB1 gateway net network with static VLANs"
        subnet_vlan: 207
        subnet_type: "IPv4"
        subnet_network: "172.0.88.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.88.50"
        subnet_dhcp_to: "172.0.88.254"
        subnet_gateway: "172.0.88.1"
        subnet_bootmode: "Static"
      - subnet_name: "LAB1-MANILLA"
        subnet_description: "LAB1 Manilla network with static VLANs"
        subnet_vlan: 208
        subnet_type: "IPv4"
        subnet_network: "172.0.92.0"
        subnet_mask: "255.255.252.0"
        subnet_ipam: "Random DB"
        subnet_dhcp_from: "172.0.92.50"
        subnet_dhcp_to: "172.0.92.254"
        subnet_gateway: "172.0.92.1"
        subnet_bootmode: "Static"


#############################################################
# Variables to set up the compute profile to allow the
# foreman to spin up instances in the libvirt environment
#############################################################

foreman_compute_resources_libvirt:
  - name: "libvirt-mnaio"
    provider: "libvirt"
    url: "qemu+ssh://root@{{ katello_host_ip }}/system"
    organizations: 
      - '{{ lab_org_name }}'
    locations: 
      - '{{ lab_location_name }}'
    description: "Local Libvirt Instance"
    provisioning_subnet:
      subnet_name: "MNAIO-PROV"
      subnet_description: "MNAIO provisioning subnet"
      subnet_type: "IPv4"
      subnet_network: "{{ provisioning_network_cidr.split('/')[0] }}"
      subnet_mask: "{{ provisioning_netmask }}"
      subnet_ipam: "Random DB"
      subnet_dhcp_from: "{{ provisioning_range_start }}"
      subnet_dhcp_to: "{{ provisioning_range_end }}"
      subnet_gateway: "{{ provisioning_gateway_ip }}"
      subnet_bootmode: "DHCP"
      subnet_domains:
        - "openstacklocal"
        - "lab1.{{ lab_base_domain_name }}"
      subnet_locations:
        - "{{ lab_location_name }}"
        - "Default Location"
      subnet_organizations:
        - "{{ lab_org_name }}"
        - "Default Organization"

# List used to associate custom provisioning templates to
foreman_provisioning_template_operating_systems:
  - "Ubuntu Xenial"
  - "Ubuntu Bionic"
  - "CentOS 8"
  - "RHEL 8"

##################################################################
# Info for compute profiles
# These map out flavors to images along with some other settings
# to make provisioning easier. These values were pulled from
# the db after utilizing the GUI to set them.
##################################################################
foreman_compute_profiles:
  - name: "osa-infra-ubuntu-bionic"
    compute_attributes: 
      - compute_resource: "libvirt-mnaio"
        vm_attrs:
          cpus: "12"
          cpu_mode: "default"
          memory: "17179869184"     # 16384 x 1024 x 1024
          image_id: "/var/lib/libvirt/images/Ubuntu18.04.qcow2"
          nics_attributes:
            0:
              type: "network"
              network: "provisioning"
              bridge: ""
              model: "virtio"
          volumes_attributes:
            0:
              pool_name: "images"
              capacity: "16G"
              allocation: "0G"
              format_type: "qcow2"



#############################################################
# List of puppet environment names to use for provisioning.
# These will be tied to the default and lab org & loc.
#############################################################
puppet_environment_names:
  - "labdev"
  - "labtest"
  - "labprod"


##########################################################
# We will create some host groups to map to various roles
# being tested in the labs here.
##########################################################

host_groups:
  - name: "kube-ironic-ubuntu-bionic"
    architecture: "x86_64"
    operatingsystem: "Ubuntu Bionic"
    description: "Generic kubernetes test box running ubuntu bionic on ironic"
    compute_profile: "ironic-standard_baremetal-ubuntu-bionic"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"
  - name: "osa-ironic-standard-xenial"
    architecture: "x86_64"
    operatingsystem: "Ubuntu Xenial"
    description: "Ironic infra,compute & logging nodes running xenial"
    compute_profile: "ironic-standard_baremetal-ubuntu-xenial"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"
  - name: "osa-ironic-storage-xenial"
    architecture: "x86_64"
    operatingsystem: "Ubuntu Xenial"
    description: "Ironic ceph nodes running xenial"
    compute_profile: "ironic-storage-perf_baremetal-ubuntu-xenial"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"
  - name: "osa-ironic-standard-bionic"
    architecture: "x86_64"
    operatingsystem: "Ubuntu Bionic"
    description: "Ironic infra,compute & logging nodes running bionic"
    compute_profile: "ironic-standard_baremetal-ubuntu-bionic"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"
  - name: "osa-ironic-storage-bionic"
    architecture: "x86_64"
    operatingsystem: "Ubuntu Bionic"
    description: "Ironic ceph nodes running bionic"
    compute_profile: "ironic-storage-perf_baremetal-ubuntu-bionic"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"
  - name: "osp-ironic-standard-centos-8"
    architecture: "x86_64"
    operatingsystem: "CentOS 8"
    description: "Undercloud running centos 8"
    compute_profile: "ironic-standard_baremetal-centos-8"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"
  - name: "osp-ironic-standard-rhel-8"
    architecture: "x86_64"
    operatingsystem: "RHEL 8"
    description: "Undercloud running rhel 8"
    compute_profile: "ironic-standard_baremetal-rhel-8"
    compute_resource: "phobos-int.rpc.rackspace.com"
    environment: "labprod"
    puppet_proxy: "{{ instance_name }}.localdomain"
    puppet_ca_proxy: "{{ instance_name }}.localdomain"
    organizations:
      - '{{ lab_org_name }}'
    locations:
      - '{{ lab_location_name }}'
    root_pass: "change4me"

